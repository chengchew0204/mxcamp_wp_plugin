 <!-- wp:html -->
 <style>
  body.map {margin: 0;}
  @media screen and (max-width: 1050px) {
      body.bodycardopened.map header#header .ct-container-fluid>div:first-child {opacity: 1;}
   }

  .slide_10 {background-position: center bottom;}
      
      .map .card.ct-container{margin:0}
      .map .card-content{padding-top:0}
      .map .layer {
        z-index: -1;
        position: absolute;
        top: 0;
        left: 0;
        margin:auto;
        height: auto;
        width: 100%;
      }

.layer {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
object-fit: cover;
display: none;
z-index: -1;
transition: opacity 0.15s ease-in-out;
}

.layer.active {
display: block;
opacity: 1;
z-index: 0;
}

.layer.transitioning {
display: block;
opacity: 0;
z-index: 1;
}
      .outline {
        display: none;
        position: absolute;
        top: 0;
      }

        .slide-show-container {
          display: inline-block;
          height: 100px;
          width: 100px;
          border: black 1px solid;
          background: grey;
        }
        .detail {
          overflow: hidden;
          z-index: 20;
          position: absolute;
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: transparent;
          -moz-user-select: -moz-none;
          -webkit-user-select: none;
          -ms-user-select: none;
          user-select: none;
/* opacity:0.4;background:blue; */
        }
        #casita-detail {
          top: 29%;
          left: 0;
          width:18%;
          height: 29%;
        }
        #central-detail {
          top: 40%;
          left: 38%;
          width: 17%;
          height: 39%;
        }
        #chozas-detail {
          top: 29%;
          left: 18%;
          width: 19%;
          height: 49%;
        }
        #calle-detail {
          top: 52%;
          left: 58%;
          width: 31%;
          height: 35%;
        }
        #jardin-detail {
          top: 8%;
          left: 71%;
          width: 28%;
          height: 36%;
        }
        .onmouseover-detail:hover{
           cursor: url('https://camp.mx/wp-content/uploads/custom-cursor.png'), auto;
        }
        #focus-point {
          top:0;
          right: 0;
          height:1px;
          width:0;
        }
.map-container {
  position: relative;
  height: 100%;
  width: fit-content;
  margin: 0 auto;
}
img {
  max-height: 100%;
  vertical-align: middle;
max-width:none;
}  
         .map .card.ct-container {
           max-width: 100dvw;
         }
        .map .card-content {
            max-width: 100dvw;
          /*  overflow-x: scroll;*/
        }
 .interactive-map {
  overflow-x: scroll;
  height: 100dvh;
  position: absolute;
  top: 0;
  left: 0;
  display: flex;
  width: 100dvw;
}     
.map {
         margin: auto;
        }
      
      /* start background video hiding per media query */
          .mobile-background-video {
               display: none;
          }
          .desktop-background-video {
               display: block;
          }
      @media (max-width: 568px) {
          .mobile-background-video {
               display: block;
          }
          .desktop-background-video {
               display: none;
          }
        }


@media (min-aspect-ratio: 5550/1600) 
{ 
   /*for browser ratio greater than map image ratio */
.map-container {
     width: 100%;
     height: auto;
     margin: 0 0;
      }
 .interactive-map {
  overflow-x: hidden;
  overflow-y:hidden;
  height: auto;
  width: 100dvw;
  }
img {
  max-height: auto;
  vertical-align: middle;
  max-width: 100%;
  } 
}
@media (min-aspect-ratio: 2570/1600) 
{ 
   /*for browser ratio greater than map image ratio */
.map-container {
     width: 100%;
     height: auto;
     margin: 0 0;
      }
 .interactive-map {
  overflow-x: hidden;
  overflow-y: scroll;
  height: auto;
  width: 100dvw;
  }
img {
  max-height: auto;
  vertical-align:middle;
  max-width: 100%;
  } 
} 
</style>
<div class="interactive-map" ID="imap">
<div class="map-container">
<img id="central-down-1" class="map layer" src="https://camp.mx/wp-content/uploads/02-central-down-1.jpg" alt="Map" />
<img id="central-down-2" class="map layer" src="https://camp.mx/wp-content/uploads/03-central-down-2.jpg" alt="Map" />
<img id="central-down-3" class="map layer" src="https://camp.mx/wp-content/uploads/04-central-down-3.jpg" alt="Map" />
<img id="chozas-down-1" class="map layer" src="https://camp.mx/wp-content/uploads/05-chozas-down-1.jpg" alt="Map" />
<img id="casita-down-1" class="map layer" src="https://camp.mx/wp-content/uploads/06-casa-down-1.jpg" alt="Map" />
<img id="casita-down-2" class="map layer" src="https://camp.mx/wp-content/uploads/07-casa-down-2.jpg" alt="Map" />
<img id="calle-down-1" class="map layer" src="https://camp.mx/wp-content/uploads/08-calle-down-1.jpg" alt="Map" />
<img id="calle-down-2" class="map layer" src="https://camp.mx/wp-content/uploads/09-calle-down-2.jpg" alt="Map" />
<img id="calle-down-3" class="map layer" src="https://camp.mx/wp-content/uploads/10-calle-down-3.jpg" alt="Map" />
<img id="jardin-down-1" class="map layer" src="https://camp.mx/wp-content/uploads/11-foro-down-1.jpg" alt="Map" />
<img id="jardin-down-2" class="map layer" src="https://camp.mx/wp-content/uploads/12-foro-down-2.jpg" alt="Map" />
<img id="jardin-down-3" class="map layer" src="https://camp.mx/wp-content/uploads/13-foro-down-3.jpg" alt="Map" />
<img id="jardin-down-4" class="map layer" src="https://camp.mx/wp-content/uploads/14-foro-down-4.jpg" alt="Map" />
<img id="map" class="map active" src="https://camp.mx/wp-content/uploads/01-start-palapas.jpg" alt="Map" /> 
<div id="central-detail" class="detail onmouseover-detail"> </div>
<div id="casita-detail" class="detail onmouseover-detail"> </div>
<div id="chozas-detail" class="detail onmouseover-detail"> </div>
<div id="calle-detail" class="detail onmouseover-detail"> </div>
<div id="jardin-detail" class="detail onmouseover-detail"> </div>
<div id="cosina-detail" class="detail onmouseover-detail" style="top:65%;left:29%;width:10%;height:15%;"></div>
<div id="noclick1" class ="detail" style="top:28%;left:65%;width:21%;height:28%;" onclick="return false;"></div>
<div id="noclick2" class="detail" style="top:46%;left:29%;width:10%;height:20%;" onclick="return false;"></div>

<div id="focus-point" class="detail"> </div>
<div id="mapExit1" class="detail mapExit onmouseover-detail" style="top:10%;left:0%;width:68%;height:20%;opacity:0.1;xbackground:blue;"></div>
<div id="mapExit2" class="detail mapExit onmouseover-detail" style="bottom:0;left:0%;width:74%;height:20%;opacity:0.1;xbackground:blue;"></div>
<div id="mapExit3" class="detail mapExit onmouseover-detail" style="top:30%;left:0%;width:7%;height:55%;opacity:0.1;xbackground:blue;"></div>
<div id="mapExit4" class="detail mapExit onmouseover-detail" style="top:33%;right:0%;width:7%;height:60%;opacity:0.1;xbackground:blue;"></div>
</div></div>
<script>
   let hasOpenedMap = false;
   
   // Auto-opening disabled - user must click manually
   // document.addEventListener("DOMContentLoaded", function () {
   // const mapSection = document.querySelector("#mapa");
   // const mapTitle = document.querySelector("#mapa .card-header h2");
   // 
   // if (!mapSection || !mapTitle) return;
   // 
   // const observer = new IntersectionObserver((entries) => {
   //   entries.forEach((entry) => {
   //     if (entry.isIntersecting && !hasOpenedMap) {
   //       mapTitle.click();
   //       observer.unobserve(mapSection); 
   //     }
   //   });
   // }, {
   //   threshold: 0.5
   // });
   // 
   // observer.observe(mapSection);
   // });
  let currentLayer = undefined

  function resetMapToInitialState() {
    console.log('Resetting map to initial state...');
    
    // Reset currentLayer to undefined
    currentLayer = undefined;
    
    // Hide all layers and reset their states
    const allLayers = document.querySelectorAll('.layer');
    allLayers.forEach(layer => {
      layer.classList.remove('active', 'transitioning');
      layer.style.zIndex = -1;
      layer.style.display = 'none';
      layer.style.opacity = '';
    });
    
    // Show only the base map (initial state)
    const baseMap = document.querySelector("#map");
    if (baseMap) {
      baseMap.style.display = 'block';
      baseMap.classList.add('active');
      baseMap.style.zIndex = 0;
      baseMap.style.opacity = '1';
    }
    
    // Clear all event listeners and reset click handlers
    removeAllClickListeners();
    
    // Remove any hanging event listeners
    try {
      document.removeEventListener('click', handleClickOutside);
    } catch (e) {
      console.log('No handleClickOutside to remove');
    }
    
    // Reset contours from the contour engine
    if (typeof contourEngine !== 'undefined' && contourEngine && contourEngine.resetToInitialState) {
      contourEngine.resetToInitialState();
    }
    
    // Reset click listeners to initial state
    setTimeout(() => {
      setAllClickListeners();
    }, 100);
    
    console.log('Map reset complete - ready for fresh interaction');
  }

  function closeMap(e) {
    e.preventDefault();
    e.stopPropagation();
    console.log('Closing map...');
    
    // Reset map state before closing
    resetMapToInitialState();
    
    // Close the map card
    const mapHeader = document.querySelector("#mapa .card-header") || document.querySelector("#map .card-header");
    if (mapHeader) {
      mapHeader.click();
    } else {
      console.warn('Map header not found for closing');
    }
  }


function addExitListeners() {
const mapExits = document.querySelectorAll(".mapExit");

mapExits.forEach((map) => {
   map.addEventListener('click', closeMap); 
})
console.log("maps...")
}
function clickOutside(event, ele, cb) {
// Si el click fue en un elemento .mapExit, no hacemos nada
if (event.target.classList.contains('mapExit')) return;

if (!ele.contains(event.target)) {
  if (currentLayer) {
    currentLayer.style.zIndex = -1;
  }
  currentLayer = undefined;
  event.preventDefault();
  removeAllClickListeners();
  setAllClickListeners();
  cb();
  document.removeEventListener('click', handleClickOutside);
}
}

  let handleClickOutside;
  
  function onClickOutside(event, ele, cb) {
    handleClickOutside = (event) => clickOutside(event, ele, cb);
    document.addEventListener('click', handleClickOutside);
  }

  function openDetail(event, element, mapIds, prevMapId) {
    let currentMapIndex = 0;
    let nextMapId = mapIds[currentMapIndex];
    let nextNextMapId = mapIds[currentMapIndex + 1];
    let map = document.querySelector("#mapa");
    let nextLayer = document.querySelector("#" + nextMapId);
    
    if (!nextLayer) {
      console.warn(`Layer ${nextMapId} not found`);
      return;
    }

    // Capture the old layer before updating currentLayer
    const oldLayer = currentLayer;

        // Function to perform smooth layer transition
    const performTransition = () => {
      console.log(`Switching to layer: ${nextMapId}`);
      
      // Ensure image is ready and start transition
      if (nextLayer.complete && nextLayer.naturalWidth > 0) {
                // Hide ALL layers first to prevent any bleed-through
        const allLayers = document.querySelectorAll('.layer');
        allLayers.forEach(layer => {
          layer.classList.remove('active');
          layer.style.zIndex = -1;
          layer.style.display = 'none';
        });
        
        // Ensure only old and new layers are visible during transition
        if (oldLayer) {
          oldLayer.style.display = 'block';
          oldLayer.classList.add('active');
          oldLayer.style.zIndex = 0;
        }
        
        // Make new layer visible but transparent for smooth transition
        nextLayer.style.display = 'block';
        nextLayer.classList.add("transitioning");
        nextLayer.style.zIndex = 2; // Higher than old layer
        
        // Force reflow
        nextLayer.offsetHeight;
        
        // Fade in new layer
        requestAnimationFrame(() => {
          nextLayer.classList.remove("transitioning");
          nextLayer.classList.add("active");
          
          // Hide old layer after transition starts
          setTimeout(() => {
            if (oldLayer && oldLayer !== nextLayer) {
          oldLayer.classList.remove("active");
          oldLayer.style.zIndex = -1;
              oldLayer.style.display = 'none';
        }
        currentLayer = nextLayer;
            nextLayer.style.zIndex = 0;
            handleSequence();
          }, 160); // Slightly longer than CSS transition (150ms)
        });
      } else {
        // Wait for image to load
        const onLoad = () => {
          nextLayer.removeEventListener("load", onLoad);
          performTransition();
        };
        nextLayer.addEventListener("load", onLoad, { once: true });
      }
    };

        const handleSequence = () => {
      // Handle previous layer cleanup
        if (prevMapId) {
          let prevLayer = document.querySelector("#" + prevMapId);
        if (prevLayer) {
          prevLayer.classList.remove("active");
          prevLayer.style.zIndex = -1;
        }
          document.removeEventListener("click", handleClickOutside);
        } else {
          try {
            document.removeEventListener("click", handleClickOutside);
          } catch {
            console.log("handleClickOutside is not defined");
          }
        }

        if (nextNextMapId) {
          // There are more layers to go
        let prevLayerId = mapIds.shift();
          setClickListeners(element, mapIds, prevLayerId);
        onClickOutside(event, element, function() {
          nextLayer.classList.remove("active");
            nextLayer.style.zIndex = -1;
          });
        } else {
          // Final layer logic
          try {
          element.addEventListener("click", function() {
              if (currentLayer) {
              currentLayer.classList.remove("active");
                currentLayer.style.zIndex = -1;
              }
              currentLayer = undefined;
              removeAllClickListeners();
              document.removeEventListener("click", handleClickOutside);
              setTimeout(() => {
                setAllClickListeners();
              }, 0);
            });
          } catch {
            console.log("handleClickOutside is not defined");
          }
        onClickOutside(event, element, function() {
          nextLayer.classList.remove("active");
            nextLayer.style.zIndex = -1;
        });
      }
    };

    // Start the transition
    performTransition();
  }
  function setClickListeners(element, mapIds, prevMapId=undefined) {
    element.addEventListener("click", handleOpenDetail = (event) => openDetail(event, element, mapIds, prevMapId),{once: true})
  }
  const map = document.querySelector("#mapa")
  function setAllClickListeners() {
    const casitaDetail = document.querySelector("#casita-detail")
    const centralDetail = document.querySelector("#central-detail")
    const chozasDetail = document.querySelector("#chozas-detail")
    const calleDetail = document.querySelector("#calle-detail")
    const jardinDetail = document.querySelector("#jardin-detail")
    const cosinaDetail = document.querySelector("#cosina-detail")

    setClickListeners(casitaDetail, ["casita-down-1", "casita-down-2"])
    setClickListeners(centralDetail, ["central-down-1", "central-down-2", "central-down-3"])
    setClickListeners(chozasDetail, ["chozas-down-1"])
    setClickListeners(calleDetail, ["calle-down-1", "calle-down-2", "calle-down-3"])
    setClickListeners(jardinDetail, ["jardin-down-1", "jardin-down-2", "jardin-down-3", "jardin-down-4"])
    setClickListeners(cosinaDetail, ["central-down-1", "central-down-2", "central-down-3"])
      addExitListeners(); 
}
  function removeAllClickListeners() {
    let clickableElements = document.getElementsByClassName("detail")
    for (let element of clickableElements) {
      // Don't remove listeners from mapExit elements
      if (element.classList.contains('mapExit')) continue;
      
      // copy and replacing element in order to remove listeners with certainty
      let newElement = element.cloneNode(true)
      element.parentNode.replaceChild(newElement, element)
    }
    try {
      document.removeEventListener("click", handleClickOutside)
    } catch (e) {
      console.log('No handleClickOutside to remove');
    }
  }

  setAllClickListeners()

  // IMAGE PRELOADER for smooth layer transitions
  class ImagePreloader {
    constructor() {
      this.preloadedImages = new Map();
      this.isPreloading = false;
    }

    async preloadAllMapLayers() {
      if (this.isPreloading) return;
      this.isPreloading = true;

      console.log('Starting map layer preloading...');

      const mapLayerUrls = [
        'https://camp.mx/wp-content/uploads/02-central-down-1.jpg',
        'https://camp.mx/wp-content/uploads/03-central-down-2.jpg', 
        'https://camp.mx/wp-content/uploads/04-central-down-3.jpg',
        'https://camp.mx/wp-content/uploads/05-chozas-down-1.jpg',
        'https://camp.mx/wp-content/uploads/06-casa-down-1.jpg',
        'https://camp.mx/wp-content/uploads/07-casa-down-2.jpg',
        'https://camp.mx/wp-content/uploads/08-calle-down-1.jpg',
        'https://camp.mx/wp-content/uploads/09-calle-down-2.jpg',
        'https://camp.mx/wp-content/uploads/10-calle-down-3.jpg',
        'https://camp.mx/wp-content/uploads/11-foro-down-1.jpg',
        'https://camp.mx/wp-content/uploads/12-foro-down-2.jpg',
        'https://camp.mx/wp-content/uploads/13-foro-down-3.jpg',
        'https://camp.mx/wp-content/uploads/14-foro-down-4.jpg'
      ];

      const preloadPromises = mapLayerUrls.map(url => this.preloadImage(url));

      try {
        await Promise.all(preloadPromises);
        console.log('All map layers preloaded successfully!');
      } catch (error) {
        console.warn('Some images failed to preload:', error);
      }

      this.isPreloading = false;
    }

    preloadImage(url) {
      return new Promise((resolve, reject) => {
        if (this.preloadedImages.has(url)) {
          resolve(url);
          return;
        }

        const img = new Image();
        img.onload = () => {
          this.preloadedImages.set(url, img);
          console.log(`Preloaded: ${url.split('/').pop()}`);
          resolve(url);
        };
        img.onerror = () => reject(new Error(`Failed to preload: ${url}`));
        img.src = url;
      });
    }

    isImagePreloaded(url) {
      return this.preloadedImages.has(url);
    }
  }

  // SIMPLIFIED CONTOUR SYSTEM v3.0
  // Hover to show, click to hide workflow
  class SimpleContourEngine {
    constructor() {
      // Contour configuration mapping
      this.contourConfig = {
        'central-detail': 'https://camp.mx/wp-content/uploads/palapa-hover-central.png',
        'casita-detail': 'https://camp.mx/wp-content/uploads/palapa-hover-casa.png',
        'chozas-detail': 'https://camp.mx/wp-content/uploads/palapa-hover-chozas.png',
        'calle-detail': 'https://camp.mx/wp-content/uploads/palapa-hover-calle.png',
        'jardin-detail': 'https://camp.mx/wp-content/uploads/palapa-hover-foro.png',
        'cosina-detail': 'https://camp.mx/wp-content/uploads/palapa-hover-central.png'
      };

      this.activeContours = new Set(); // Track multiple active contours
      this.contourElements = new Map(); // Store created contour elements
      this.overlay = null;
      
      this.init();
    }

    // Create overlay container for contours
    createOverlay() {
      if (document.getElementById('contour-overlay')) {
        this.overlay = document.getElementById('contour-overlay');
        return;
      }

      const mapContainer = document.querySelector('.map-container');
      this.overlay = document.createElement('div');
      this.overlay.id = 'contour-overlay';
      this.overlay.style.cssText = `
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        pointer-events: none;
        z-index: 15;
      `;
      mapContainer.appendChild(this.overlay);
    }

    // Create contour element for an area
    createContourElement(areaId) {
      const contour = document.createElement('img');
      contour.src = this.contourConfig[areaId];
      contour.style.cssText = `
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        object-fit: cover;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        display: none;
      `;
      contour.dataset.area = areaId;
      this.overlay.appendChild(contour);
      this.contourElements.set(areaId, contour);
      return contour;
    }

    // Show contour for specific area
    showContour(areaId) {
      if (!this.contourConfig[areaId]) return;
      
      let contour = this.contourElements.get(areaId);
      if (!contour) {
        contour = this.createContourElement(areaId);
      }

      // Show this contour
      contour.style.display = 'block';
      requestAnimationFrame(() => {
        contour.style.opacity = '0.8';
      });
      
      this.activeContours.add(areaId);
      console.log(`Showing contour for: ${areaId}`);
    }

    // Hide specific contour
    hideContour(areaId) {
      const contour = this.contourElements.get(areaId);
      if (!contour) return;

      contour.style.opacity = '0';
      setTimeout(() => {
        contour.style.display = 'none';
      }, 300);
      
      this.activeContours.delete(areaId);
      console.log(`Hiding contour for: ${areaId}`);
    }

    // Hide all active contours
    hideAllContours() {
      this.activeContours.forEach(areaId => this.hideContour(areaId));
      console.log(`Hiding all contours`);
    }

    // Reset the contour engine to initial state
    resetToInitialState() {
      console.log('Resetting contour engine...');
      
      // Hide all active contours
      this.hideAllContours();
      
      // Clear the active contours set
      this.activeContours.clear();
      
      // Reset all contour elements
      this.contourElements.forEach((contour, areaId) => {
        contour.style.opacity = '0';
        contour.style.display = 'none';
      });
      
      console.log('Contour engine reset complete');
    }

    // Setup event listeners
    setupEventListeners() {
      const mapContainer = document.getElementById('imap');
      if (!mapContainer) return;

      let isClickAction = false;

      // Handle hover events on detail areas
      mapContainer.addEventListener('mouseover', (event) => {
        if (isClickAction) return; // Ignore hover during click processing
        
      const detail = event.target.closest('.detail.onmouseover-detail');
        if (!detail || !this.contourConfig[detail.id]) return;
        
        // Hide all other contours when hovering a new area
        this.hideAllContours();
        // Show the contour for this area
        this.showContour(detail.id);
      });

      // Handle click events
      mapContainer.addEventListener('click', (event) => {
        isClickAction = true;
        
        const detail = event.target.closest('.detail.onmouseover-detail');
        
        if (detail && this.contourConfig[detail.id]) {
          // Clicking on a building area - hide its contour
          this.hideContour(detail.id);
        } else {
          // Clicking outside building areas - hide all contours
          this.hideAllContours();
        }
        
        // Reset click flag after processing
        setTimeout(() => { isClickAction = false; }, 50);
        
        event.stopPropagation();
      });
    }

    // Initialize the system
    init() {
      console.log('Initializing Simple Contour Engine...');
      
      this.createOverlay();
      this.setupEventListeners();
      
      console.log('Simple Contour Engine Ready - Hover to show, click to hide');
    }

    // Cleanup method
    destroy() {
      this.contourElements.forEach(contour => contour.remove());
      this.contourElements.clear();
      this.activeContours.clear();
      if (this.overlay) {
        this.overlay.remove();
      }
    }
  }

  // Initialize the Image Preloader and Contour Engine
  const imagePreloader = new ImagePreloader();
  const contourEngine = new SimpleContourEngine();
  
  // Start preloading images immediately for smooth transitions
  imagePreloader.preloadAllMapLayers();
</script>
<!-- /wp:html -->